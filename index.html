<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulação de Instalação e Build</title>
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #0f141a;
      --text: #e5eef7;
      --muted: #9aa7b5;
      --accent: #6ee7f8;
      --accent-2: #60a5fa;
      --border: #1f2a37;
      --success: #34d399;
    }

    * { box-sizing: border-box; }

    html, body {
      height: 100%;
      margin: 0;
      background: radial-gradient(1200px 700px at 20% -10%, #0c1424 0%, var(--bg) 55%, #081018 100%);
      color: var(--text);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    .page {
      height: 100%;
      display: grid;
      place-items: center;
      padding: 28px;
    }

    .card {
      width: 100%;
      max-width: 720px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04);
      padding: 28px;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 18px;
    }

    .badge {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      background: linear-gradient(135deg, rgba(110,231,248,.2), rgba(96,165,250,.2));
      border: 1px solid rgba(110,231,248,.35);
      box-shadow: inset 0 0 20px rgba(96,165,250,.16), 0 6px 18px rgba(0,0,0,.25);
    }

    .badge-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 16px var(--accent);
      animation: pulse 1.6s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: .9; }
      50% { transform: scale(1.35); opacity: .7; }
    }

    .title {
      font-size: 16px;
      letter-spacing: .2px;
      color: var(--muted);
      margin: 0;
    }

    .headline {
      margin: 2px 0 0 0;
      font-size: 22px;
      font-weight: 600;
      letter-spacing: .2px;
    }

    .status {
      margin: 22px 0 10px 0;
      font-size: 15px;
      color: var(--text);
    }

    .ellipsis::after {
      content: '…';
      display: inline-block;
      width: 1ch;
      text-align: left;
      overflow: hidden;
      animation: dots 1.8s steps(3, end) infinite;
    }

    @keyframes dots {
      0% { content: ''; }
      33% { content: '.'; }
      66% { content: '..'; }
      100% { content: '...'; }
    }

    .progress {
      height: 14px;
      width: 100%;
      background: rgba(255,255,255,.05);
      border: 1px solid var(--border);
      border-radius: 999px;
      overflow: hidden;
      position: relative;
    }

    .bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent-2), var(--accent));
      box-shadow: 0 0 30px rgba(110,231,248,.35);
      transition: width .35s ease;
    }

    .percent {
      margin-top: 10px;
      font-variant-numeric: tabular-nums;
      font-size: 14px;
      color: var(--muted);
    }

    .footer {
      margin-top: 22px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: var(--muted);
      font-size: 12px;
    }

    .hint { opacity: .9; }
    .done { color: var(--success); }
  </style>
</head>
<body>
  <div class="page">
    <div class="card" role="region" aria-label="Progresso de instalação e build">
      <div class="header">
        <div class="badge" aria-hidden="true"><div class="badge-dot"></div></div>
        <div>
          <p class="title">Preparando o projeto para produção</p>
          <h2 class="headline">Instalação e build em andamento</h2>
        </div>
      </div>

      <div id="status" class="status ellipsis" aria-live="polite">Iniciando…</div>

      <div class="progress" aria-label="Barra de progresso" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" role="progressbar">
        <div id="bar" class="bar"></div>
      </div>
      <div id="percent" class="percent">0%</div>

      <div class="footer">
        <div id="hint" class="hint">Isso pode levar alguns minutos. Você pode continuar usando seu computador.</div>
        <div id="final" class="done" hidden>Pronto para deploy.</div>
      </div>
    </div>
  </div>

  <script>
    const statusEl = document.getElementById('status');
    const barEl = document.getElementById('bar');
    const percentEl = document.getElementById('percent');
    const progressEl = document.querySelector('.progress');
    const hintEl = document.getElementById('hint');
    const finalEl = document.getElementById('final');

    let speedFactor = 0.4; // 1 = bem lento; >1 acelera

    (function initSpeedFromQuery() {
      const params = new URLSearchParams(location.search);
      const s = parseFloat(params.get('speed'));
      if (!isNaN(s) && s > 0) { speedFactor = s; }
    })();

    function sleep(ms) {
      return new Promise(r => setTimeout(r, ms / speedFactor));
    }

    function setProgress(p) {
      const pct = Math.max(0, Math.min(100, p));
      barEl.style.width = pct + '%';
      percentEl.textContent = pct.toFixed(0) + '%';
      progressEl.setAttribute('aria-valuenow', pct.toFixed(0));
    }

    async function animateStep(label, from, to, durationMs) {
      statusEl.textContent = label;
      statusEl.classList.add('ellipsis');

      const start = performance.now();
      const duration = durationMs;
      let current = from;
      setProgress(current);

      while (true) {
        const elapsed = (performance.now() - start) * speedFactor; // corrigir percepção para steps
        const t = Math.min(1, elapsed / duration);
        const value = from + (to - from) * t;
        if (Math.abs(value - current) >= 0.2) {
          current = value;
          setProgress(current);
        }
        if (t >= 1) break;
        await sleep(120);
      }

      setProgress(to);
      statusEl.classList.remove('ellipsis');
    }

    async function run() {
      // Passos longos e lentos, sem visual de terminal
      const steps = [
        { label: 'Preparando ambiente', from: 0, to: 5, duration: 15000 },
        { label: 'Instalando pacotes', from: 5, to: 55, duration: 90000 },
        { label: 'Compilando build de produção', from: 55, to: 88, duration: 60000 },
        { label: 'Otimizando assets', from: 88, to: 96, duration: 30000 },
        { label: 'Finalizando', from: 96, to: 100, duration: 20000 }
      ];

      for (const step of steps) {
        await animateStep(step.label, step.from, step.to, step.duration);
        await sleep(600);
      }

      statusEl.textContent = 'Tudo pronto';
      hintEl.hidden = true;
      finalEl.hidden = false;
    }

    run();
  </script>
</body>
</html>
